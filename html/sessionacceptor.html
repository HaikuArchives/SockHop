<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="Author" CONTENT="Jeremy Friesner">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.05 [en] (WinNT; I) [Netscape]">
   <TITLE>The SHSessionAcceptor API</TITLE>
</HEAD>
<BODY>
<B><U>SHSessionAcceptor API</U></B>

<P>The SHSessionAcceptor class is another specialized utility class.&nbsp;
This one provides a quick and easy way to set up a "server thread", that
can accept an arbitrary number of <A HREF="directconnection.html">SHDirectConnections</A>
for you.&nbsp; It operates as a factory object--it listens on a specified
port for incoming connections, and whenever it receives one, it creates
a new <A HREF="directconnection.html">SHDirectConnection</A> object.&nbsp;
By default, the SHSessionAcceptor object will keep track of the <A HREF="directconnection.html">SHDirectConnection</A>
objects for you, but if you prefer, you can detach the <A HREF="directconnection.html">SHDirectConnection</A>
objects from the SHSessionAcceptor and handle them yourself.

<P>Whenever a new connection is accepted, the SHSessionAcceptor object
will send an SH_CODE_CONNECTIONOPEN BMessage to the (target) specified
in the BMessenger constructor.&nbsp; When a session ends, an SH_CODE_CONNECTIONCLOSED
BMessage will be sent.&nbsp; Also, by default any BMessages that the remote
client of the session sends will be forwarded to (target) also--but a custom
SHAccessPolicy could change this behavior by calling <A HREF="directconnection.html">SHDirectConnection</A>::SetTarget()
in its OnSessionAccepted() method.

<P>The SHSessionAcceptor API is as follows:

<P>
<HR WIDTH="100%">

<P><B>SHSessionAcceptor(const BMessenger &amp; target, <A HREF="accesspolicy.html">SHAccessPolicy</A>
* policy, bool startImmediately)</B>

<P>This constructor creates an SHSessionAcceptor using the given <A HREF="accesspolicy.html">SHAccessPolicy</A>,
that will send messages to the given (target).&nbsp; (policy) determines
which port this SHSessionAcceptor will listen on, and which connections
it will accept.&nbsp; For most purposes, an <A HREF="defaultaccesspolicy.html">SHDefaultAccessPolicy</A>
object will suffice.&nbsp; Note that (policy) becomes property of the SHSessionAcceptor
object, and should not be touched by any other code after this constructor
returns.

<P>If you specify (startImmediately) to be false, then that this SHSessionAcceptor
won't become active until its Start() method is called (see below).

<P>
<HR WIDTH="100%">
<BR><B>~SHSessionAcceptor();</B>

<P>Destroys the SHSessionAcceptor object, and any <A HREF="directconnection.html">SHDirectConnections</A>
that are attached to it.

<P>
<HR WIDTH="100%">
<BR><B>bool Start();</B>

<P>Causes the SHSessionAcceptor to bind to the port specified by its policy
object, and fire off an acceptor thread to begin accepting connections.&nbsp;
Returns true on success, false if there was an error setting up.&nbsp;
If the SHSessionAcceptor is already accepting connections, this method
will return true with no side effects.

<P>
<HR WIDTH="100%">
<BR><B><A HREF="shnodespecs.html">SHNodeSpec</A> GetAcceptSpec() const;</B>

<P>Returns the <A HREF="shnodespecs.html">SHNodeSpec</A> that the SHSessionAcceptor
is listening on (as determined by the policy object given to the constructor).&nbsp;
If anyone wants to know how to connect to your SHSessionAcceptor, tell
them to create an "active" <A HREF="directconnection.html">SHDirectConnection</A>
that connects to this <A HREF="shnodespecs.html">SHNodeSpec</A>!&nbsp;
Note that the return value of this method is only valid after the Start()
method has been called.&nbsp; If the port number of the <A HREF="shnodespecs.html">SHNodeSpec</A>
this method returns is zero, then there was an error setting up the accepting
socket/port--most likely, the requested port was already in use by another
program.

<P>
<HR WIDTH="100%">
<BR><B>status_t CloseSession(int32 sessionID)</B>

<P>Closes the held session that has the given ID.&nbsp; Returns B_NO_ERROR
if the session was found and closed, B_ERROR if it could not be found.

<P>
<HR WIDTH="100%">
<BR><B>void CloseAllSessions()</B>

<P>Closes all sessions held by this SHSessionAcceptor.
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>status_t SendMessageToAllSessions(const BMessage &amp; message)</B>

<P>Broadcasts the given BMessage to all held sessions.&nbsp; Returns B_NO_ERROR
if everything goes okay, B_ERROR if there were problems sending the message
(in which some of the sessions may not have got the message)
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>status_t SendMessageToSession(int32 messageID, const BMessage &amp;
message)</B>

<P>Sends the given BMessage to the session with the given (messageID).&nbsp;
Returns B_NO_ERROR if the message send succeeded, B_ERROR if a session
with the given (messageID) was not found, or some other error code if the
SendMessage() call failed.

<P>
<HR WIDTH="100%">
<BR><B><A HREF="directconnection.html">SHDirectConnection</A> * DetachSession(int32
messageID)</B>

<P>Removes the session with the given (messageID) from the SHSessionAcceptor's
control, and returns it to the calling code as an <A HREF="directconnection.html">SHDirectConnection</A>.&nbsp;
Returns NULL if the session with the given (messageID) could not be found.

<P>NOTE:&nbsp; Once this method returns an <A HREF="directconnection.html">SHDirectConnection</A>,
the SHSessionAcceptor is no longer associated with the <A HREF="directconnection.html">SHDirectConnection</A>
in any way,&nbsp; The calling code becomes sole owner of the <A HREF="directconnection.html">SHDirectConnection</A>
object, and it becomes the calling code's responsibility to delete the
<A HREF="directconnection.html">SHDirectConnection</A> when it is done
with it.
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>void DetachAllSessions(BList &amp; getConnectionObjects)</B>

<P>Calls DetachSession() on all current sessions, and adds pointers to
the <A HREF="directconnection.html">SHDirectConnection</A> objects for
all sessions as items in the passed-in BList.&nbsp; By calling this method,
the calling code accepts responsibility for deleting <I>all</I> the <A HREF="directconnection.html">SHDirectConnection</A>
objects added to the passed-in BList.
<BR>&nbsp;
</BODY>
</HTML>
