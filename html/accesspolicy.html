<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="Author" CONTENT="Jeremy Friesner">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.05 [en] (WinNT; I) [Netscape]">
   <TITLE>SHAccessPolicy class description</TITLE>
</HEAD>
<BODY>
<B><U>The SHAccessPolicy inheritance API</U></B>
(derives from <A HREF="component.html">SHComponent</A> -> <A HREF="distributableobject.html">SHDistributableObject</A>
-> BArchivable)

<P>The SHAccessPolicy class gives you some amount of control over what
actions clients that connect to your server or <A HREF="sessionacceptor.html">SHSessionAcceptor</A>
can tell SockHop to take.&nbsp; It also is used to specify which TCP port
a <A HREF="sockhopserver.html">SockHop server</A> or <A HREF="sessionacceptor.html">SHSessionAcceptor</A>
should listen on for incoming connections.&nbsp; A SockHop node will call
various methods in its SHAccessPolicy object to determine if it has permission
to perform certain potentially dangerous actions.&nbsp; Note that if your
SHAccessPolicy object allows connecting clients to download and execute
add-ons, then the added-on code will be able to circumvent any restrictions
imposed (because the add-ons are full-fledged C++ code, and can make system
calls (etc) directly).

<P>Most of the methods in the SHAccessPolicy class are abstract, and must
be defined by a subclass.&nbsp; For many common purposes, however, you
can use an <A HREF="defaultaccesspolicy.html">SHDefaultAccessPolicy</A>
object, which defines all methods and is thus instantiatable.
<BR>&nbsp;
<BR>
<HR WIDTH="100%">
<BR><B>SHAccessPolicy(BMessage * archive)</B>

<P>Rehydration constructor.&nbsp; See the note regarding server command
line arguments, under Archive().
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>virtual status_t Archive(BMessage * archive, bool deep = true) const</B>

<P>Dehydration method.&nbsp; Subclasses should call this from their own
Archive() method.
<BR>NOTE:&nbsp; When libsockhop.so is executed to start a <A HREF="sockhopserver.html">SockHop
server</A>, any parameters entered on the command line as "key=value" will
be added <I>as strings</I> to a BMessage that will be used to create an
SHAccessPolicy object.&nbsp; So if you wish to allow users to specify a
parameter in your SHAccessPolicy subclass from the command line when they
start a <A HREF="sockhopserver.html">SockHop server</A>, be sure to store
that parameter into (archive) as a string, under a documented field name.

<P>
<HR WIDTH="100%">
<BR><B>virtual void OnServerStartup()</B>

<P>Called when the <A HREF="sockhopserver.html">SockHop server</A> starts.&nbsp;
Default version does nothing.
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>virtual void OnServerShutdown()</B>

<P>Called when the <A HREF="sockhopserver.html">SockHop server</A> exits.&nbsp;
Default version does nothing.&nbsp; (Note: not currently called when shutdown
is due to a CTRL-C)
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>virtual <A HREF="shnodespecs.html">SHNodeSpec</A> GetListeningLocation()
= 0</B>

<P>Should return an <A HREF="shnodespecs.html">SHNodeSpec</A> with its
port number field set to the port number the owning object should listen
on for incoming connections.&nbsp; If it returns an <A HREF="shnodespecs.html">SHNodeSpec</A>
with a port number zero, the system will choose an available port number
to listen on.&nbsp; The other fields in the <A HREF="shnodespecs.html">SHNodeSpec</A>
aren't used by SockHop, although your code can fill them in for its own
use, if it wants.
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>virtual bool OkayToAcceptConnection(<A HREF="shnodespecs.html">SHNodeSpec</A>
&amp; connectingSpec) = 0</B>

<P>Should return true iff it's okay to accept a connection from the given
host.&nbsp;&nbsp; (connectingSpec) contains information about the potential
connectee.&nbsp; You can also modify (connectingSpec), if you feel the
need to, although this isn't generally recommended unless you know what
you're doing.
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>virtual bool OnSessionAccepted(<A HREF="directconnection.html">SHDirectConnection</A>
&amp; connection)</B>

<P>Called when an <A HREF="directconnection.html">SHDirectConnection</A>
has been created for a new connection.&nbsp; Default implementation calls
connection.Start() so that the <A HREF="directconnection.html">SHDirectConnection</A>
can begin operation. Should return true if the <A HREF="directconnection.html">SHDirectConnection</A>
is to continue, or false if there was an error and the <A HREF="directconnection.html">SHDirectConnection</A>
should be aborted.&nbsp; If you override this method, be sure to call the
OnSessionAccepted() of your parent class, so that the session will be Start()'d.
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>virtual void OnNodeStartup()</B>

<P>Called when a new SockHop node starts running.&nbsp; Default version
does nothing.&nbsp; (Note that each new node gets its own copy of the SHSessionAcceptor--this
is necessary since each new node may be running in a different address
space!)
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>virtual void OnNodeShutdown()</B>

<P>Called when a new SockHop node quits.&nbsp; Default version does nothing.
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>virtual bool OkayToWriteFile(const char * fileName) = 0</B>

<P>Should return true iff it's okay to write to the given file.
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>virtual bool OkayToReadFile(const char * fileName) = 0</B>

<P>Should return true iff it's okay to read from the given file.

<P>
<HR WIDTH="100%">
<BR><B>virtual bool OkayToInstantiateObject(const BMessage &amp; archive)
= 0</B>

<P>Should return true iff it's okay to instantiate an <A HREF="distributableobject.html">SHDistributedObject</A>
from (archive).&nbsp; This will be called whenever a new <A HREF="sorters.html">SHSorter</A>,
<A HREF="workers.html">SHWorker</A>, or SHAccessPolicy is to be instantiated
by a node.

<P>
<HR WIDTH="100%">
<BR><B>virtual SHAccessPolicy * MakeNodePolicy()</B>

<P>This method is called whenever a new SockHop node is created.&nbsp;
This method should return a new SHAccessPolicy object for the new node
to use, or return NULL if you want the node to use a clone of this SHAccessPolicy.&nbsp;&nbsp;
This default implementation returns NULL.&nbsp; When returning an SHAccessPolicy,
make sure it was allocated either with SHCreateDistributableObject(), or
the new operator.
<BR>&nbsp;
<HR WIDTH="100%">
<BR><B>virtual int GetDefaultDebugLevel()</B>

<P>Should return the initial debugging level for the server or node.&nbsp;
Currently, 0 means no debug printing, >0 means debug printing; more levels
may be implemented in the future.&nbsp; The default implementation of this
method returns 0.
<BR>&nbsp;
<BR>
<HR WIDTH="100%">
<BR><B>virtual int32 GetDefaultThreadPriority()</B><B></B>

<P>Should return the priority to be given to newly spawned SockHop threads.&nbsp;
The default implementation returns B_NORMAL_PRIORITY.

<P>
<HR WIDTH="100%">
<BR><B>virtual int32 GetDefaultTransmissionEncoding()</B>

<P>Should return the default encoding method for BMessage data that is
sent across TCP links.&nbsp; The result should be one of the SH_ENCODING_*
tokens listed in SockHopConstants.h.&nbsp; The default implementation returns
SH_ENCODING_NONE.
<BR>&nbsp;
</BODY>
</HTML>
